---
name: explore
description: Explore a target website to capture artifacts and generate application specification. Uses browser automation to crawl pages, delegate to subagents, and synthesize results.
arguments:
  url:
    description: "Target URL to explore (e.g., https://claude.ai)"
    required: true
  depth:
    description: "Maximum exploration depth (number of hops from root)"
    default: 2
  auth:
    description: "Path to Playwright storage state for authenticated sessions (optional)"
    required: false
---

# Explore Website

This command explores a target website using browser automation to capture artifacts and generate a comprehensive application specification.

## What This Command Does

When invoked, this command will:

1. **Prepare exploration structure** - Create `.spec/` directories for artifacts
2. **Initialize explore list** - Track URLs to explore
3. **Delegate to subagents** - Use Task tool to spawn exploration-subagent for each page
4. **Capture artifacts** - Collect screenshots, snapshots, summaries from each page
5. **Synthesize results** - Invoke exploration-summary-agent to generate app_spec.txt and feature_list.json

## Arguments

### `url` (required)
- **Description**: Target URL to explore
- **Format**: Full URL including protocol (e.g., "https://claude.ai")

### `depth` (optional, default: 2)
- **Description**: Maximum exploration depth (hops from root URL)
- **Values**:
  - `1` = Homepage only
  - `2` = Homepage + direct links (recommended)
  - `3` = Homepage + links + their links (comprehensive)

### `auth` (optional)
- **Description**: Path to Playwright storage state JSON file
- **Use case**: For sites requiring authentication

## Usage Examples

### Explore homepage and direct links:
```
/explore url="https://claude.ai" depth=2
```

### Explore with authentication:
```
/explore url="https://app.example.com" depth=2 auth=".spec/info/auth/storage_state.json"
```

## Exploration Workflow

You are the EXPLORATION AGENT. Your job is to explore the target website, capture replication artifacts, and synthesize an app spec and feature list.

### INPUTS
- Explore URL: {EXPLORE_URL} (provided by user)
- Max depth: {EXPLORE_DEPTH} (provided by user)

### OUTPUT LOCATIONS (ALL UNDER .spec/)
- Explore list: `.spec/explore_list.json`
- Artifacts root: `.spec/info/`

### BROWSER SETTINGS
- Default to headless Playwright
- Use viewport 1600x900
- If authentication is required, switch to headful, ask user to complete login, then save Playwright storage state to `.spec/info/auth/storage_state.json`

### SUBAGENT POLICY
Do NOT try to explore everything in a single context window. Use the Task tool to spawn subagents (exploration-subagent) that explore specific pages or clusters. You only coordinate the process, maintain the explore list, and consolidate artifacts.

---

## STEP 1: Prepare Directories

Create these directories if missing:
```
.spec/info/screenshots/
.spec/info/snapshots/
.spec/info/summaries/
.spec/info/auth/
```

## STEP 2: Initialize Explore List

Create `.spec/explore_list.json`:

```json
{
  "root_url": "https://example.com",
  "max_depth": 2,
  "items": [
    {
      "id": 1,
      "url": "https://example.com/",
      "page": "home",
      "depth": 0,
      "status": "pending",
      "discovered_from": null,
      "artifacts": []
    }
  ]
}
```

**Rules:**
- Only include URLs on the same root domain or subdomains
- `depth` is hops from root (root is depth 0)
- Do not add URLs with depth greater than max_depth
- Normalize URLs (strip fragments, trailing slashes) before deduping
- Deduplicate by (`url`, `page`) tuple
- Use statuses: `pending`, `in_progress`, `done`, `blocked`

## STEP 3: Explore Pending Items

For each `pending` item within the depth limit:

1. **Use the Task tool** to spawn exploration-subagent
2. **Pass**: assigned item JSON + max depth
3. **Wait** for subagent to complete
4. **Verify**:
   - Item status updated to "done"
   - Artifacts saved under `.spec/info/`
   - New items appended to explore list
   - Log entry in `.spec/info/web_explore_log.md`

**Repeat** until no `pending` items remain within depth.

## STEP 4: Synthesize Results

When exploration is complete (no pending items within depth):

1. Review all captured artifacts
2. Invoke exploration-summary-agent to generate `app_spec.txt` from artifacts
3. **Organize `.spec/feature_list.json`**:
   - Read all test cases generated by subagents
   - Reorder by implementation priority (auth first, then core features, then polish)
   - Ensure IDs are sequential (1, 2, 3, ...)
   - Verify no duplicate test cases
   - Group by category (functional first, then style)
   - Add summary statistics comment at top

**Reordering logic:**
1. Authentication/authorization features first
2. Core data models and CRUD operations
3. Main user flows and navigation
4. UI components and interactions
5. Edge cases and error handling
6. Style and polish features last

**Output organized feature_list.json** with proper structure and ordering.

## Output

After completion, you'll have:
- `.spec/app_spec.txt` - Comprehensive application specification
- `.spec/feature_list.json` - Organized test cases (generated by subagents, organized by you)
- `.spec/info/` - All captured artifacts (screenshots, snapshots, summaries)
- `.spec/explore_list.json` - Exploration history

## Next Steps

After exploration completes, use:
```
/implement
```

This will start the implementation process using the generated specification and feature list.
